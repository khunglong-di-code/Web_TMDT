<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chi Tiết Sản Phẩm | Tất Tần Tập</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="image/logo.png" type="image/png">

  <style>
    :root { --primary-color: #ff6600; --secondary-color: #333; }
    
    .detail-container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }
    .detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 50px; align-items: start; }
    
    /* Cột trái: Ảnh */
    .gallery-wrapper { position: sticky; top: 20px; }
    .main-image-frame { width: 100%; height: 500px; border: 1px solid #eee; border-radius: 12px; overflow: hidden; margin-bottom: 15px; display: flex; align-items: center; justify-content: center; background: #fff; position: relative; }
    .main-image-frame img { width: 100%; height: 100%; object-fit: contain; transition: opacity 0.3s ease-in-out; }
    .thumbnail-list { display: flex; gap: 10px; overflow-x: auto; margin-bottom: 30px; padding-bottom: 5px;}
    .thumbnail-list::-webkit-scrollbar { height: 6px; }
    .thumbnail-list::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; }
    .thumb-item { width: 70px; height: 70px; border: 2px solid #eee; border-radius: 8px; cursor: pointer; object-fit: cover; opacity: 0.6; transition: 0.3s; }
    .thumb-item:hover, .thumb-item.active { border-color: var(--primary-color); opacity: 1; transform: translateY(-2px); }

    /* Feedback Area */
    .feedback-area { border-top: 2px solid #eee; padding-top: 20px; margin-top: 20px; }
    .feedback-title { font-size: 1.2rem; font-weight: bold; margin-bottom: 15px; color: var(--secondary-color); border-left: 4px solid var(--primary-color); padding-left: 10px; }
    .review-list { max-height: 300px; overflow-y: auto; margin-bottom: 20px; padding-right: 5px; border-bottom: 1px dashed #eee;}
    .review-list::-webkit-scrollbar { width: 5px; }
    .review-list::-webkit-scrollbar-thumb { background: #ccc; border-radius: 10px; }
    .review-item { background: #f9f9f9; padding: 12px; border-radius: 8px; margin-bottom: 10px; font-size: 0.95rem; }
    .review-header { display: flex; justify-content: space-between; margin-bottom: 5px; }
    .reviewer-name { font-weight: bold; color: #333; }
    .review-stars { color: #f1c40f; letter-spacing: 2px; }
    .review-content { color: #555; line-height: 1.4; white-space: pre-line; }
    .review-date { font-size: 0.75rem; color: #999; margin-top: 6px; text-align: right; display: block; font-style: italic;}

    .feedback-form input, .feedback-form textarea, .feedback-form select { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: inherit; }
    .btn-submit-fb { background: #333; color: #fff; border: none; padding: 12px 20px; border-radius: 6px; cursor: pointer; width: 100%; font-weight: bold; transition: 0.3s; }
    .btn-submit-fb:hover { background: var(--primary-color); }
    .btn-submit-fb:disabled { background: #ccc; cursor: not-allowed; }

    /* Cột phải: Info */
    .product-title { font-size: 2rem; color: var(--secondary-color); margin-bottom: 10px; }
    
    /* Dòng thông báo ưu đãi */
    .promo-suggestion {
        background-color: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 12px;
        margin-bottom: 20px;
        border-radius: 4px;
        font-size: 0.9rem;
        color: #856404;
    }
    .promo-suggestion i { margin-right: 8px; color: #ff6600; }

    /* Giá tiền */
    .product-price { font-size: 1.5rem; color: var(--primary-color); font-weight: bold; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 20px; display: flex; align-items: center; gap: 15px; }
    .old-price { text-decoration: line-through; color: #999; font-size: 1.1rem; font-weight: normal; }
    
    .product-desc { color: #555; margin-bottom: 30px; line-height: 1.8; text-align: justify; }
    .control-group { margin-bottom: 20px; }
    .control-group label { display: block; font-weight: bold; margin-bottom: 8px; }
    .control-group select, .control-group input { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; outline: none; cursor: pointer; }
    
    .btn-add-cart { width: 100%; background: var(--secondary-color); color: white; padding: 18px; border: none; border-radius: 8px; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: 0.3s; text-transform: uppercase; margin-top: 20px; }
    .btn-add-cart:hover { background: var(--primary-color); transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }

    .freeship-suggestion { margin-top: 15px; text-align: center; font-size: 0.95rem; color: #28a745; font-weight: 600; font-style: italic; }

    /* Toast Notification */
    #toast-notification { visibility: hidden; min-width: 300px; background-color: #28a745; color: #fff; text-align: center; border-radius: 8px; padding: 20px; position: fixed; z-index: 9999; left: 50%; top: 50%; transform: translate(-50%, -50%); font-size: 18px; font-weight: 600; box-shadow: 0 4px 15px rgba(0,0,0,0.3); opacity: 0; transition: opacity 0.3s ease-in-out; }
    #toast-notification.show { visibility: visible; opacity: 1; }

    @media (max-width: 768px) { .detail-grid { grid-template-columns: 1fr; gap: 30px; } .main-image-frame { height: 350px; } }
  </style>
</head>
<body>

  <header class="site-header">
    <div class="header-inner">
      <a class="logo" href="index.html"><img src="image/Tattantap_logo1.png" alt="Logo"></a>
      <nav class="main-nav">
        <ul>
          <li><a href="index.html">Trang chủ</a></li>      
          <li><a href="about.html">Về chúng tôi</a></li>
          <li><a href="products.html" class="active">Cửa hàng</a></li>
          <li><a href="faq.html">Hỗ trợ</a></li>
        </ul>
      </nav>
      <div class="header-actions">
          <a class="cart-link" href="cart.html">
            <i class="fa-solid fa-bag-shopping"></i>
            <span class="cart-count" id="cart-count">0</span>
          </a>
      </div>
    </div>
  </header>

  <main class="detail-container">
      <div class="detail-grid">
          <div class="gallery-wrapper">
              <div class="main-image-frame">
                  <img id="main-img" src="" alt="Ảnh sản phẩm">
              </div>
              <div class="thumbnail-list" id="thumb-container"></div>

              <div class="feedback-area">
                  <h3 class="feedback-title">Feedback Khách Hàng</h3>
                  <div id="review-list" class="review-list">
                      <div style="text-align:center; padding:15px; color:#666;"><i class="fa-solid fa-spinner fa-spin"></i> Đang tải đánh giá...</div>
                  </div>
                  <form class="feedback-form" onsubmit="return false;">
                      <h4 style="margin-bottom: 10px; font-size:1rem;">Gửi feedback của bạn</h4>
                      <input type="text" id="fb-name" placeholder="Tên hiển thị (VD: Lan Anh)">
                      <input type="text" id="fb-code" placeholder="Nhập mã đơn hàng (Bắt buộc)*">
                      <select id="fb-rating">
                          <option value="5">⭐⭐⭐⭐⭐ - Tuyệt vời</option>
                          <option value="4">⭐⭐⭐⭐ - Hài lòng</option>
                          <option value="3">⭐⭐⭐ - Bình thường</option>
                          <option value="2">⭐⭐ - Tệ</option>
                          <option value="1">⭐ - Rất tệ</option>
                      </select>
                      <textarea id="fb-comment" rows="3" placeholder="Chia sẻ cảm nhận về sản phẩm..."></textarea>
                      <button class="btn-submit-fb" id="btn-submit" onclick="submitFeedback()">GỬI FEEDBACK</button>
                  </form>
              </div>
          </div>

          <div class="info-wrapper">
              <h1 class="product-title" id="p-name">Đang tải...</h1>
              
              <div id="quantity-promo" class="promo-suggestion" style="display: none;">
                <i class="fa-solid fa-tags"></i>
                <span>Mua từ <b>5 đôi</b> giảm ngay <b>20%</b>. Mua từ <b>10 đôi</b> giảm sâu đến <b>40%</b>!</span>
              </div>

              <div class="product-price" id="price-container">
                  <span id="p-price">0₫</span>
              </div>

              <div class="product-desc" id="p-desc"></div>

              <div id="options-area">
                  <div class="control-group" id="opt-size">
                      <label>Kích thước:</label>
                      <select id="sel-size" onchange="handleSelectionChange()">
                          <option value="S">Nhỏ (S)</option>
                          <option value="M">Vừa (M)</option>
                          <option value="L">Lớn (L)</option>
                      </select>
                  </div>
                  <div class="control-group" id="opt-color">
                      <label>Màu sắc:</label>
                      <select id="sel-color" onchange="handleSelectionChange()">
                          <option value="Trắng">Trắng</option>
                          <option value="Đen">Đen</option>
                      </select>
                  </div>
              </div>

              <div class="control-group">
                  <label>Số lượng:</label>
                  <input type="number" id="sel-qty" value="1" min="1" onchange="updatePrice()">
              </div>

              <button class="btn-add-cart" onclick="addToCart()">Thêm Vào Giỏ Hàng</button>
              
              <p class="freeship-suggestion">
                  <i class="fa-solid fa-truck-fast"></i> Mua 10 đôi tất cùng 1 quyển sổ để được freeship ngay thôi nào!
              </p>
          </div>
      </div>
  </main>
  <footer>
    <style>
        .copyright-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .social-bottom-right {
            display: flex;
            gap: 15px;
        }
        .social-bottom-right a {
            color: inherit;
            font-size: 20px;
            text-decoration: none;
            opacity: 0.8;
            transition: 0.3s;
        }
        .social-bottom-right a:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        .bct-logo {
            width: 150px;
            margin-top: 15px;
            display: block;
        }

        /* Thêm CSS cho Maps để không làm thay đổi layout chính */
        .footer-map {
            margin-top: 15px;
            width: 100%;
            height: 150px;
            border-radius: 8px;
            border: 0;
        }
    </style>

    <div class="footer-grid">
      <div class="footer-col">
        <h4>Về Tất Tần Tập</h4>
        <p>Chúng tôi cung cấp các sản phẩm văn phòng phẩm và phụ kiện thời trang tối giản, chất lượng cao với mức giá hợp lý.</p>
        
        <a href="http://online.gov.vn/Home/WebDetails/10940" target="_blank">
            <img src="image_dcd887.png" alt="Đã thông báo Bộ Công Thương" class="bct-logo">
        </a>
      </div>

      <div class="footer-col">
        <h4>Liên Hệ</h4>
        <p><i class="fa-solid fa-location-dot"></i> Số 3, Ngách 5/17, Phố Hoàng Tích Trí, Phường Kim Liên, Hà Nội.</p>
        <p><i class="fa-solid fa-phone"></i> 0967 067 332</p>
        <p><i class="fa-solid fa-envelope"></i> sale@3tcuahang.online</p>
        
        <iframe 
            class="footer-map"
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3724.634125740428!2d105.8340795759685!3d21.00730018851416!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3135ac1ea0ae8b5b%3A0x6cc9075796d61570!2zUGjhu5EgSG_DoG5nIFTDrWNoIFRyw60sIMSQ4buRbmcgRGEsIEjDoCBO4buZaSwgVmnhu4d0IE5hbQ!5e0!3m2!1svi!2s!4v1700000000000" 
            allowfullscreen="" 
            loading="lazy" 
            referrerpolicy="no-referrer-when-downgrade">
        </iframe>
      </div>

      <div class="footer-col">
        <h4>Hỗ Trợ</h4>
        <ul>
          <li><a href="faq.html">Câu hỏi thường gặp</a></li>
          <li><a href="#">Chính sách đổi trả</a></li>
          <li><a href="#">Hướng dẫn mua hàng</a></li>
          <p><i class="fa-solid fa-envelope"></i> hotro@tattantap.shop</p>
        </ul>
      </div>
    </div>

    <div class="copyright">
        <div class="copyright-container">
            <span>© 2025 Bản quyền thuộc về Tất Tần Tập.</span>
            
            <div class="social-bottom-right">
                <a href="https://www.instagram.com/tattantap/" target="_blank" title="Instagram">
                    <i class="fa-brands fa-instagram"></i>
                </a>
                <a href="https://www.facebook.com/profile.php?id=61582495130534" target="_blank" title="Facebook">
                    <i class="fa-brands fa-facebook"></i>
                </a>
            </div>
        </div>
    </div>
  </footer>

  <div id="toast-notification">
      <i class="fa-solid fa-check-circle"></i> Đã thêm vào giỏ hàng!
  </div>

  <script>
    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxRrUyTKLc98YgQ5Ppjn6SOEzPF6RWt4NRfQ6VGFU_vFX1FpVOckUAeygKnLXFesp6yvQ/exec";

    const productsDB = {
        'sock': {
            name: "Tất Cotton Premium", type: 'sock',
            images: ["image/1.png", "image/tatcolung1.jpg", "image/tatcodai.jpg", "image/conganden.png", "image/colungden2.png", "image/codaiden.png"],
            desc: "<p><strong>Chất liệu:</strong> 90% Cotton tự nhiên, 10% Spandex giúp co giãn 4 chiều.</p>"
        },
        'book': {
            name: "Sổ Tay Minimalist", type: 'book', price_fixed: 35000,
            images: ["image/sach1.png", "image/sach2.png"],
            desc: "<p><strong>Loại giấy:</strong> Giấy kem ngà chống lóa, định lượng 100gsm dày dặn.</p>"
        }
    };

    const params = new URLSearchParams(window.location.search);
    const productId = params.get('id') || 'sock';
    const productData = productsDB[productId];

    function initPage() {
        if (!productData) return;
        document.getElementById('p-name').innerText = productData.name;
        document.getElementById('p-desc').innerHTML = productData.desc;
        const thumbContainer = document.getElementById('thumb-container');
        productData.images.forEach((src, index) => {
            let thumb = document.createElement('img');
            thumb.src = src; thumb.className = 'thumb-item'; thumb.setAttribute('data-index', index);
            thumb.onclick = () => { updateMainImage(index); syncDropdownsWithImage(index); }
            thumbContainer.appendChild(thumb);
        });
        updateMainImage(0);
        
        // Hiện gợi ý giảm giá nếu là Tất
        if (productData.type === 'sock') {
            document.getElementById('quantity-promo').style.display = 'block';
        } else {
            document.getElementById('options-area').style.display = 'none';
        }
        
        handleSelectionChange(); updateCartCount(); loadReviewsFromSheet();
    }

    function updateMainImage(index) {
        if (productData.images[index]) {
            const mainImg = document.getElementById('main-img');
            mainImg.style.opacity = '0.5';
            setTimeout(() => { mainImg.src = productData.images[index]; mainImg.style.opacity = '1'; }, 150);
            document.querySelectorAll('.thumb-item').forEach(el => el.classList.remove('active'));
            const activeThumb = document.querySelector(`.thumb-item[data-index="${index}"]`);
            if(activeThumb) activeThumb.classList.add('active');
        }
    }

    function handleSelectionChange() {
        updatePrice();
        if (productData.type === 'sock') {
            const size = document.getElementById('sel-size').value;
            const color = document.getElementById('sel-color').value;
            let sizeIndex = (size === 'S') ? 0 : (size === 'M') ? 1 : 2;
            let colorOffset = (color === 'Đen') ? 3 : 0;
            updateMainImage(colorOffset + sizeIndex);
        }
    }

    function syncDropdownsWithImage(index) {
        if (productData.type !== 'sock') return;
        const colorSelect = document.getElementById('sel-color');
        const sizeSelect = document.getElementById('sel-size');
        if (index < 3) {
            colorSelect.value = "Trắng";
            sizeSelect.value = (index === 0) ? "S" : (index === 1) ? "M" : "L";
        } else {
            colorSelect.value = "Đen";
            sizeSelect.value = (index === 3) ? "S" : (index === 4) ? "M" : "L";
        }
        updatePrice();
    }

    function updatePrice() {
        const qty = parseInt(document.getElementById('sel-qty').value) || 1;
        const priceContainer = document.getElementById('price-container');
        let baseUnitPrice = 0;
        let finalUnitPrice = 0;
        
        if (productData.type === 'sock') {
            const size = document.getElementById('sel-size').value;
            baseUnitPrice = (size === 'S') ? 10000 : (size === 'M') ? 12000 : 14000;

            if (qty >= 10) finalUnitPrice = (size === 'S') ? 6000 : (size === 'M') ? 7200 : 8400; // Giảm 40%
            else if (qty >= 5) finalUnitPrice = baseUnitPrice * 0.8; // Giảm 20%
            else finalUnitPrice = baseUnitPrice;
        } else {
            baseUnitPrice = productData.price_fixed;
            finalUnitPrice = baseUnitPrice;
        }

        const totalBase = baseUnitPrice * qty;
        const totalFinal = finalUnitPrice * qty;

        if (totalFinal < totalBase) {
            priceContainer.innerHTML = `
                <span class="old-price">${Math.round(totalBase).toLocaleString('vi-VN')}₫</span>
                <span>${Math.round(totalFinal).toLocaleString('vi-VN')}₫</span>
            `;
        } else {
            priceContainer.innerHTML = `<span>${totalFinal.toLocaleString('vi-VN')}₫</span>`;
        }
    }

    function addToCart() {
        const qty = parseInt(document.getElementById('sel-qty').value) || 1;
        let item = { id: productId, name: productData.name, type: productData.type, quantity: qty, image: document.getElementById('main-img').src };
        if (productData.type === 'sock') {
            item.size = document.getElementById('sel-size').value;
            item.color = document.getElementById('sel-color').value;
        }
        let cart = JSON.parse(localStorage.getItem('myCart')) || [];
        let existingItem = cart.find(x => x.id === item.id && x.size === item.size && x.color === item.color);
        if (existingItem) existingItem.quantity += qty;
        else cart.push(item);
        localStorage.setItem('myCart', JSON.stringify(cart));
        updateCartCount();
        const toast = document.getElementById("toast-notification");
        toast.className = "show";
        setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
    }

    function updateCartCount() {
        let cart = JSON.parse(localStorage.getItem('myCart')) || [];
        document.getElementById('cart-count').innerText = cart.reduce((acc, item) => acc + item.quantity, 0);
    }

    function loadReviewsFromSheet() {
        const list = document.getElementById('review-list');
        fetch(`${GOOGLE_SCRIPT_URL}?id=${productId}`).then(res => res.json()).then(data => {
            list.innerHTML = ""; 
            if (!Array.isArray(data) || data.length === 0) {
                list.innerHTML = '<div style="text-align:center; color:#999; padding:15px;">Chưa có feedback nào.</div>';
                return;
            }
            data.forEach(rv => {
                const stars = '★'.repeat(rv.rating) + '☆'.repeat(5 - rv.rating);
                list.insertAdjacentHTML('beforeend', `<div class="review-item"><div class="review-header"><span class="reviewer-name">${rv.name}</span><span class="review-stars">${stars}</span></div><div class="review-content">${rv.comment}</div><span class="review-date">${new Date(rv.date).toLocaleDateString('vi-VN')}</span></div>`);
            });
        });
    }

    function submitFeedback() {
        const code = document.getElementById('fb-code').value;
        const comment = document.getElementById('fb-comment').value;
        if (!code || !comment) { alert("Vui lòng điền đủ thông tin!"); return; }
        const btn = document.getElementById('btn-submit');
        btn.disabled = true;
        fetch(GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify({ type: 'feedback', product_id: productId, name: document.getElementById('fb-name').value || 'Khách hàng', code, rating: document.getElementById('fb-rating').value, comment }) })
        .then(() => { alert("Cảm ơn bạn đã feedback!"); loadReviewsFromSheet(); })
        .finally(() => btn.disabled = false);
    }

    initPage();
  </script>
</body>
</html>
