<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cửa Hàng | Tất Tần Tập</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="image/Tattantap_logo1.png" type="image/png">

  <style>
    /* CSS CHO PHẦN SẢN PHẨM ĐƠN GIẢN HÓA */
    .product-grid {
        display: flex;
        justify-content: center;
        gap: 30px;
        flex-wrap: wrap;
    }
    .product-card {
        width: 300px;
        cursor: pointer; /* Con trỏ tay để biết bấm được */
        transition: transform 0.3s;
    }
    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    }
    .btn-select {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 20px;
        width: 100%;
        margin-top: 10px;
        cursor: pointer;
        font-weight: bold;
    }

    /* CSS CHO POP-UP TRƯỢT (SLIDING SHEET) */
    .popup-overlay {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 2000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }
    .popup-overlay.active {
        opacity: 1;
        visibility: visible;
    }

    .sliding-sheet {
        position: fixed;
        bottom: -100%; /* Giấu dưới đáy màn hình */
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
        max-width: 500px; /* Giới hạn chiều rộng trên PC */
        background: white;
        border-radius: 20px 20px 0 0;
        padding: 20px;
        z-index: 2001;
        transition: bottom 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Hiệu ứng trượt nảy */
        box-shadow: 0 -5px 20px rgba(0,0,0,0.2);
        max-height: 80vh;
        overflow-y: auto;
    }

    .sliding-sheet.active {
        bottom: 0; /* Trượt lên vị trí hiển thị */
    }

    /* Chi tiết bên trong Popup */
    .sheet-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
        border-bottom: 1px solid #eee;
        padding-bottom: 15px;
    }
    .sheet-info h3 { margin: 0 0 5px 0; font-size: 1.2rem; }
    .sheet-price { color: var(--primary-color); font-weight: bold; font-size: 1.1rem; }
    .sheet-close {
        background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #999;
    }
    
    .sheet-body img {
        width: 100px; height: 100px; object-fit: cover; border-radius: 8px;
        float: left; margin-right: 15px; border: 1px solid #eee;
    }
    
    .option-group { margin-bottom: 15px; clear: both; }
    .option-group label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.9rem; }
    .option-group select, .option-group input {
        width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;
    }

    .sheet-footer { margin-top: 20px; }
    .btn-add-cart {
        width: 100%; background: var(--secondary-color); color: white;
        padding: 15px; border: none; border-radius: 8px;
        font-size: 1.1rem; font-weight: bold; cursor: pointer;
    }
    .btn-add-cart:hover { background: #1a252f; }
  </style>
</head>
<body>

  <!-- HEADER GIỮ NGUYÊN -->
  <header class="site-header">
    <div class="header-inner">
      <a class="logo" href="index.html">
        <img src="image/Tattantap_logo1.png" alt="Logo">
      </a>
      <nav class="main-nav">
        <ul>
          <li><a href="index.html">Trang chủ</a></li>      
          <li><a href="about.html">Về chúng tôi</a></li>
          <li><a href="products.html" class="active">Cửa hàng</a></li>
          <li><a href="faq.html">Hỗ trợ</a></li>
        </ul>
      </nav>
      <div class="header-actions">
          <a class="cart-link" href="cart.html">
            <i class="fa-solid fa-bag-shopping"></i>
            <span class="cart-count" id="cart-count">0</span>
          </a>
      </div>
    </div>
  </header>

  <section class="section bg-light" style="padding: 40px 5%; text-align: center;">
    <div class="container">
      <h1 style="font-size: 2rem; color: var(--secondary-color);">Cửa Hàng</h1>
      <p style="color: var(--text-gray);">Chạm vào sản phẩm để xem chi tiết</p>
    </div>
  </section>

  <!-- PHẦN HIỂN THỊ 2 SẢN PHẨM (GIAO DIỆN MỚI) -->
  <section class="section">
    <div class="container">
      <div class="product-grid">

        <!-- SẢN PHẨM 1: TẤT (Mặc định ảnh 1.png - Tất trắng ngắn) -->
        <article class="product-card" onclick="openPopup('sock')">
          <img src="image/1.png" class="product-img" alt="Tất Cotton Premium">
          <div class="product-info">
            <h3 class="product-name">Tất Cotton Premium</h3>
            <span class="product-price-preview">Từ 6.000₫ - 14.000₫</span>
            <button class="btn-select">Chọn phân loại <i class="fa-solid fa-chevron-up"></i></button>
          </div>
        </article>

        <!-- SẢN PHẨM 2: SỔ -->
        <article class="product-card" onclick="openPopup('book')">
          <img src="image/4.png" class="product-img" alt="Sổ Tay Minimalist">
          <div class="product-info">
            <h3 class="product-name">Sổ Tay Minimalist</h3>
            <span class="product-price-preview">35.000₫</span>
            <button class="btn-select">Thêm vào giỏ <i class="fa-solid fa-plus"></i></button>
          </div>
        </article>

      </div>
    </div>
  </section>

  <!-- KHUNG POP-UP TRƯỢT (SLIDING SHEET) -->
  <div class="popup-overlay" id="popup-overlay" onclick="closePopup()"></div>
  
  <div class="sliding-sheet" id="product-sheet">
      <div class="sheet-header">
          <div class="sheet-info">
              <h3 id="popup-name">Tên Sản Phẩm</h3>
              <div class="sheet-price" id="popup-price">0₫</div>
          </div>
          <button class="sheet-close" onclick="closePopup()"><i class="fa-solid fa-xmark"></i></button>
      </div>

      <div class="sheet-body">
          <img id="popup-img" src="" alt="Ảnh chi tiết">
          
          <!-- Các tùy chọn (Sẽ ẩn hiện tùy loại sản phẩm) -->
          <div id="sock-options">
              <div class="option-group">
                  <label>Kích thước (Size):</label>
                  <select id="size-sock" onchange="updatePopupState()">
                      <option value="S">Nhỏ (S)</option>
                      <option value="M">Vừa (M)</option>
                      <option value="L">Lớn (L)</option>
                  </select>
              </div>

              <div class="option-group">
                  <label>Màu sắc:</label>
                  <select id="color-sock" onchange="updatePopupState()">
                      <option value="Trắng">Trắng</option>
                      <option value="Đen">Đen</option>
                  </select>
              </div>
          </div>

          <div class="option-group">
              <label>Số lượng:</label>
              <input type="number" id="popup-qty" value="1" min="1" onchange="updatePopupState()">
          </div>
          
          <div style="clear:both;"></div>
      </div>

      <div class="sheet-footer">
          <button class="btn-add-cart" onclick="confirmAddToCart()">Xác Nhận Thêm</button>
      </div>
  </div>

  <!-- FOOTER GIỮ NGUYÊN -->
  <footer>
    <!-- ... (Giữ nguyên footer cũ của bạn) ... -->
    <style>
        .copyright-container { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .social-bottom-right { display: flex; gap: 15px; }
        .social-bottom-right a { color: inherit; font-size: 20px; text-decoration: none; opacity: 0.8; transition: 0.3s; }
        .social-bottom-right a:hover { opacity: 1; transform: scale(1.1); }
        .bct-logo { width: 150px; margin-top: 15px; display: block; }
    </style>
    <div class="footer-grid">
      <div class="footer-col">
        <h4>Về Tất Tần Tập</h4>
        <p>Chúng tôi cung cấp các sản phẩm văn phòng phẩm và phụ kiện thời trang tối giản.</p>
        <a href="http://online.gov.vn/Home/WebDetails/10940" target="_blank"><img src="image_dcd887.png" alt="BCT" class="bct-logo"></a>
      </div>
      <div class="footer-col">
        <h4>Liên Hệ</h4>
        <p><i class="fa-solid fa-location-dot"></i> Hai Bà Trưng, Hà Nội</p>
        <p><i class="fa-solid fa-phone"></i> 0967 067 332</p>
      </div>
      <div class="footer-col">
        <h4>Hỗ Trợ</h4>
        <ul><li><a href="faq.html">Câu hỏi thường gặp</a></li></ul>
      </div>
    </div>
    <div class="copyright">
        <div class="copyright-container">
            <span>© 2025 Tất Tần Tập.</span>
            <div class="social-bottom-right">
                <a href="#"><i class="fa-brands fa-instagram"></i></a>
                <a href="#"><i class="fa-brands fa-facebook"></i></a>
            </div>
        </div>
    </div>
  </footer>

  <!-- Chat Plugin (Đã thêm từ trước) -->
  <div id="fb-root"></div>
  <div id="fb-customer-chat" class="fb-customerchat"></div>
  <script>
    var chatbox = document.getElementById('fb-customer-chat');
    chatbox.setAttribute("page_id", "61582495130534N"); // Kiểm tra lại ID này, thường chỉ là số
    chatbox.setAttribute("attribution", "biz_inbox");
    window.fbAsyncInit = function() { FB.init({ xfbml : true, version : 'v18.0' }); };
    (function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = 'https://connect.facebook.net/vi_VN/sdk/xfbml.customerchat.js';
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));
  </script>

  <!-- LOGIC MỚI CHO POPUP -->
  <script>
      // 1. DATA VÀ BIẾN TOÀN CỤC
      const sockImages = {
          "S_Đen": "image/conganden.png",
          "M_Đen": "image/colung1den.png",
          "L_Đen": "image/codaiden.png",
          "S_Trắng": "image/1.png",
          "M_Trắng": "image/tatcolung1.jpg",
          "L_Trắng": "image/tatcodai.jpg"
      };
      
      let currentProductType = ''; // 'sock' hoặc 'book'

      // 2. HÀM MỞ POPUP
      function openPopup(type) {
          currentProductType = type;
          const sheet = document.getElementById('product-sheet');
          const overlay = document.getElementById('popup-overlay');
          const sockOptions = document.getElementById('sock-options');
          const qtyInput = document.getElementById('popup-qty');

          qtyInput.value = 1; // Reset số lượng về 1

          if (type === 'sock') {
              // Cấu hình cho Tất
              document.getElementById('popup-name').innerText = "Tất Cotton Premium";
              sockOptions.style.display = 'block'; // Hiện tùy chọn size/màu
              
              // Reset về mặc định
              document.getElementById('size-sock').value = 'S';
              document.getElementById('color-sock').value = 'Trắng';
              
          } else {
              // Cấu hình cho Sổ
              document.getElementById('popup-name').innerText = "Sổ Tay Minimalist";
              sockOptions.style.display = 'none'; // Ẩn tùy chọn size/màu
              document.getElementById('popup-img').src = "image/4.png";
          }

          // Cập nhật giá và ảnh lần đầu khi mở
          updatePopupState();

          // Hiển thị Popup
          overlay.classList.add('active');
          sheet.classList.add('active');
      }

      // 3. HÀM ĐÓNG POPUP
      function closePopup() {
          document.getElementById('product-sheet').classList.remove('active');
          document.getElementById('popup-overlay').classList.remove('active');
      }

      // 4. LOGIC TÍNH GIÁ VÀ ĐỔI ẢNH TRONG POPUP
      function updatePopupState() {
          const qty = parseInt(document.getElementById('popup-qty').value) || 1;
          const priceLabel = document.getElementById('popup-price');
          const imgElement = document.getElementById('popup-img');

          if (currentProductType === 'sock') {
              const size = document.getElementById('size-sock').value;
              const color = document.getElementById('color-sock').value;

              // Đổi ảnh
              const key = size + "_" + color;
              imgElement.src = sockImages[key] || 'image/1.png';

              // Tính giá Tất
              let unitPrice = 0;
              if (size === 'S') unitPrice = (qty >= 10) ? 6000 : (qty >= 5) ? 8000 : 10000;
              else if (size === 'M') unitPrice = (qty >= 10) ? 8000 : (qty >= 5) ? 10000 : 12000;
              else if (size === 'L') unitPrice = (qty >= 10) ? 10000 : (qty >= 5) ? 12000 : 14000;

              priceLabel.innerHTML = `${unitPrice.toLocaleString('vi-VN')}₫ <small style="color:#666; font-weight:normal">/đôi (Tổng: ${(unitPrice * qty).toLocaleString('vi-VN')}₫)</small>`;

          } else {
              // Tính giá Sổ
              const unitPrice = 35000;
              priceLabel.innerHTML = `${unitPrice.toLocaleString('vi-VN')}₫ <small style="color:#666; font-weight:normal">/quyển (Tổng: ${(unitPrice * qty).toLocaleString('vi-VN')}₫)</small>`;
          }
      }

      // 5. THÊM VÀO GIỎ HÀNG (LẤY DỮ LIỆU TỪ POPUP)
      function confirmAddToCart() {
          let product = {};
          const qty = parseInt(document.getElementById('popup-qty').value);

          if (currentProductType === 'sock') {
              const size = document.getElementById('size-sock').value;
              const color = document.getElementById('color-sock').value;
              const sizeName = (size === 'S') ? "Nhỏ" : (size === 'M') ? "Vừa" : "Lớn";
              
              // Tính lại giá lần cuối để lưu vào giỏ
              let price = 0;
              if (size === 'S') price = (qty >= 10) ? 6000 : (qty >= 5) ? 8000 : 10000;
              else if (size === 'M') price = (qty >= 10) ? 8000 : (qty >= 5) ? 10000 : 12000;
              else if (size === 'L') price = (qty >= 10) ? 10000 : (qty >= 5) ? 12000 : 14000;

              product = {
                  id: 'sock_' + size + '_' + color, 
                  name: `Tất Cotton (${sizeName} - ${color})`,
                  type: 'sock',
                  size: size,
                  color: color,
                  price: price,
                  quantity: qty,
                  image: document.getElementById('popup-img').src
              };
          } else {
              product = {
                  id: 'book_std',
                  name: 'Sổ Tay Minimalist',
                  type: 'book',
                  price: 35000,
                  quantity: qty,
                  image: 'image/4.png'
              };
          }

          // Lưu vào LocalStorage
          let cart = JSON.parse(localStorage.getItem('myCart')) || [];
          let existingItem = cart.find(item => item.id === product.id);
          
          if (existingItem) {
              existingItem.quantity += product.quantity;
          } else {
              cart.push(product);
          }
          localStorage.setItem('myCart', JSON.stringify(cart));
          
          // Cập nhật icon giỏ hàng và đóng popup
          updateCartCount();
          closePopup();
          alert(`Đã thêm "${product.name}" vào giỏ hàng!`);
      }

      function updateCartCount() {
          let cart = JSON.parse(localStorage.getItem('myCart')) || [];
          let total = 0;
          cart.forEach(item => total += parseInt(item.quantity));
          document.getElementById('cart-count').innerText = total;
      }

      // Khởi chạy
      updateCartCount();
  </script>

</body>
</html>
